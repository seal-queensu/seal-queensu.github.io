<html>
	<head>
		<!-- Google Tag Manager -->
		<script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
		new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
		j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
		'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
		})(window,document,'script','dataLayer','GTM-PL95WQG');</script>
		<!-- End Google Tag Manager -->
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150315178-1"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());

		  gtag('config', 'UA-150315178-1');
		</script>
		<!-- Global site tag (gtag.js) - Google Analytics -->
		<script async src="https://www.googletagmanager.com/gtag/js?id=UA-150827048-1"></script>
		<script>
		  window.dataLayer = window.dataLayer || [];
		  function gtag(){dataLayer.push(arguments);}
		  gtag('js', new Date());

		  gtag('config', 'UA-150827048-1');
		</script>
		<title>Publications</title>
		<meta charset="utf-8">
		<meta name="keywords" content="SEAL publications">
		<style type="text/css">
		.hyperlink{
			color:#337ab7;		
		}
		.hyperlink:hover{
			color:#697e91;
		}	
		.normal-style {
			@import "css/bootstrap.css";
			@import "css/font-awesome.min.css";
			@import "css/prettyPhoto.css";
			@import "css/responsive.css";
			@import "css/home.css";
		}
		.cover {
			object-fit: cover;
			width: 642;
			height: 110;
		}
		.content {
			border: solid 3px; 
			border-radius: 15px; 
			background-color: #ffffff; 
			padding: 10px;
		}
		.title-block {
			width: 100%;
			height: 40px;
			text-align: center;
			background-color: #337ab7;
			color:#fff;
			border-style: solid;
			border-width: 2px 2px 1px 2px; 
			border-radius: 15px 15px 0px 0px;
			border-color: #000;
		}
		.scroll-menu {
			width: 100%;
			border-style: solid;
			border-width: 1px 2px 2px 2px;
			border-radius: 0px 0px 15px 15px; 
		}
		.scroll-list {
			width: 100%;
			height: 125px;
			overflow-y: auto;
		}
		.column {
			float: left;
			padding-left: 10px;
			padding-right: 10px;
		}
		.left {
			width: 60%;
			text-align: left;
			padding-left: 40px;
		}
		.right {
			width: 40%;
			text-align: right;
			padding-right: 40px;
		}
		.topicleft {
			width: 70%;
			text-align: left;
			padding-left: 20px;
		}

		.topicright {
			width: 30%;
			text-align: right;
			padding-right: 40px;
		}
		.titleleft {
			width: 70%;
			text-align: left;
			padding-left: 40px;
		}

		.titleright {
			width: 30%;
			text-align: right;
			padding-right: 40px;
		}
		</style>
		<style>
		.wrap .header {
			width: 95%;
            margin: 0 auto;
        }
        .logo {
            width: 100%;
            float: left;
        }
        .menu {
        	width: 100%;
        	float: left;
        	text-align: center;
        	padding-top: 10px;
        }
        #main, #sidebar {
            width: 100%;
            float: left;
            padding: 20px;
        }
        @media only screen and (min-width: 1024px) {
            .wrap .header {
                width: 100%;
                margin: 0 auto;
            }
            #main {
                width: 70%;
                float: left;
            }
            #sidebar {
                width: 30%;
                float: left;
            }
            .logo {
                width: 40%;
                float: left;
            }
            .menu {
                width: 60%;
                float: left;
                padding-top: 25px;
                padding-left: 50px;
            }
        }        	
		</style>
		<style type="text/css">
			body{
			  background: #f2f2f2;
			}
			.search {
			  width: 100%;
			  position: relative
			}
			.searchTerm {
			  float: left;
			  width: 90%;
			  border: 2px solid #000000;
			  padding: 10px;
			  height: 40px;
			  border-radius: 5px;
			  outline: none;
			  color: #999999;
			}
			.searchTerm:focus{
			  color: #000000;
			}
			.searchButton {
			  width: 8%;
			  height: 40px;
			  background: #337ab7;
			  font-size: 16px;
			  text-align: center;
			  color: #fff;
			  border-radius: 5px;
			  float: right;
			  cursor: pointer;
			}
			.searchButton:hover {
				background: #91d7ff
			}

			.hintsButtonNormal {
				border-color:#337ab7;
				border-width:1px;
				border-radius:3px;
			}

			.hintsButtonReverse {
				color:#fff;
				background: #337ab7;
				border-color:#337ab7;
				border-width:2px;
				border-radius:2px;
			}
		</style>

		<link href="css/bootstrap.css" rel="stylesheet">
		<link href="css/font-awesome.min.css" rel="stylesheet">
		<link href="css/prettyPhoto.css" rel="stylesheet">	
		<link href="css/responsive.css" rel="stylesheet">
		<link href="css/home.css" rel="stylesheet">

	</head>

	<body class="publications">
		<!-- Google Tag Manager (noscript) -->
		<noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-PL95WQG"
		height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
		<!-- End Google Tag Manager (noscript) -->
		<header class="navbar navbar-static-top navbar-default">
        	<div class="container header"  align="center"> 
				<div class="logo" align="center">
					<a href="index.html"></a>
					<img style="height: 100px;" src="img/logos/logo_circle_normalfont.png" alt="Software Evolution and Analytics Group" hspace="0">
				</div>
		        <div class="menu">
		            <ul class="nav navbar-nav navbar-right" style="display: inline-block;float: none;">
		                <li><a href="index.html">Home</a></li>
						<li><a href="member-current.html">People</a></li>
		                <li class="active"><a href="publications.html">Publications<span class="sr-only">(current)</span></a></li>
						<li><a href="sponsors.html">Sponsors</a></li>
						<li><a href="vacancies.html">Job Vacancies</a></li>
		                <li><a href="contact.html">Contact</a></li> 
		            </ul>	          
		        </div>
			</div>			
		</header>
		<main>
			<section id="about-us">
				<div class="InfoContainer">
					<div class="container">
						
						<div class="wrap">
							<div id="main">
								<div class="content">
									<h2><b>Publications:</b></h2>
							    	<br>
								   <div class="search">
								      <input id="search-key" type="text" class="searchTerm" placeholder="Search for publications...">
								      <button id="submit" type="submit" class="searchButton">GO</button>
								   </div>
				    			
				    				<label><a class="hyperlink" href="https://dblp.uni-trier.de/pers/hd/z/Zou_0001:Ying" target="_blank">Link to DBLP</a></label>
				    				&nbsp;&nbsp;&nbsp;
				    				<label><a class="hyperlink" href="https://scholar.google.ca/citations?user=pCYlknMAAAAJ&hl=en" target="_blank">Link to Google Scholar</a></label>
				    			
				    				<div id="topic-hints"></div>
				    				<br>
				    				<table id="filter-table" class="table-borderless" width="100%" style="text-align: left">
										<tbody>
											<tr>
												<td style="padding-left: 20px"><b>Authors: </b></td>
												<td id="filter-menu-th1" style="padding-left: 0px"></td>
												<td style="padding-left: 10px"><b>Venues: </b></td>
												<td id="filter-menu-th2" style="padding-left: 0px"></td>
											</tr>
											<tr>
												<td>
													<br/>
												</td>
												<td>
													<br/>
												</td>
											</tr>
											<tr>
												<td style="padding-left: 20px"><b>Years: </b></td>
												<td id="filter-menu-th3" style="padding-left: 0px"></td>
												<td style="padding-left: 10px"><b>Sub-topics: </b></td>
												<td id="filter-menu-th4" style="padding-left: 0px"></td>
											</tr>
										</tbody>
									</table>
									<br>
				    				<label><i id="search-result"></i></label>		
								</div>
								<hr size="1" noshade>
								<div id="full-list" class="content" style="max-height:1500px;overflow-y: auto;">
								</div> 
							</div>
							<div id="sidebar">
								<div class="title-block"><h4>Publication Year</h4></div>
								<div class="scroll-menu">
									<div id="year-title-left" class="column left"></div>
									<div id="year-title-right" class="column right"></div>
									<div class="scroll-list">
										<div id="year-left" class="column left"></div>
										<div id="year-right" class="column right"></div>
									</div>
								</div>
								<br/>
								<div class="title-block"><h4>Publication Year</h4></div>
								<div class="scroll-menu">
									<div id="curve_chart"></div>
									<br>
								</div>
								<hr>
								<div class="title-block"><h4>Publication Type</h4></div>
								<div class="scroll-menu">
									<div id="type-title-left" class="column left"></div>
									<div id="type-title-right" class="column right"></div>
									<div class="scroll-list" style="height:auto;">
										<div id="type-left" class="column left"></div>
										<div id="type-right" class="column right"></div>
									</div>
								</div>
								<br/>
								<div class="title-block"><h4>Publication Type</h4></div>
								<div class="scroll-menu">
									<div id="pie_chart"></div>
									<br>
								</div>
								<hr>
								<div class="title-block"><h4>Journal Summary</h4></div>
								<div class="scroll-menu">
									<div id="jour-title-left" class="column left"></div>
									<div id="jour-title-right" class="column right"></div>
									<div class="scroll-list">
										<div id="jour-left" class="column left"></div>
										<div id="jour-right" class="column right"></div>
									</div>
								</div>
								<hr>
								<div class="title-block"><h4>Conference Summary</h4></div>
								<div class="scroll-menu">
									<div id="conf-title-left" class="column left"></div>
									<div id="conf-title-right" class="column right"></div>
									<div class="scroll-list">
										<div id="conf-left" class="column left"></div>
										<div id="conf-right" class="column right"></div>
									</div>
								</div>
								<hr>
								<div class="title-block"><h4>Research Topic</h4></div>
								<div class="scroll-menu">
									<div id="topic-title-left" class="column titleleft"></div>
									<div id="topic-title-right" class="column titleright"></div>
									<div class="scroll-list">
										<div id="topic-left" class="column topicleft"></div>
										<div id="topic-right" class="column topicright"></div>
									</div>
								</div>
								<br/>
								<div class="title-block"><h4>Main Research Areas</h4></div>
								<div class="scroll-menu">
									<div id="bar_chart"></div>
									<br>
								</div>
							</div>
						</div>
						
					</div>
				</div>		
			</section>
		</main>

		<footer id="footer">
			<div class="normal-style">    
			<div class="footer-container">
				<h2>Software Evolution and Analytics Lab (SEAL)</h2>
				<p>Department of Electrical and Computer Engineering</p>
				<p>Queen's University</p>
				<p>Kingston, Ontario, Canada</p>
			</div>
			</div>
		</footer>
				
		<style>
			#footer{
				background-color: #e7e7e7;
				color:#000;
			}
		</style>
		<script type="text/javascript" src="js/jquery.js"></script>
  		<script type="text/javascript" src="js/bootstrap.min.js"></script>
		<script type="text/javascript" src="js/jquery.min.js"></script>
		<script src="https://code.jquery.com/jquery-1.12.4.js"></script>
		<script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>
		<script src="https://d3js.org/d3.v5.min.js"></script>
		<script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>		
		<link rel="stylesheet" href="js/excel-bootstrap-table-filter-style.css"/>
  		<link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">
		<script type="text/javascript">
			//Read Publications data asynchronously
			d3.csv("publications/PublicationList.csv").then(function(data){
				var dataArray = processData(data);
				var lineNum = dataArray.length;
				var cellNum = dataArray[0].length;
				generateContent(dataArray[0], dataArray.slice(1, lineNum));

				//initialize the filterCollection
				var options = {};
				options.columnSelector = '';
				options.captions = {select_all: 'Select All'};
				var ths = [document.getElementById("filter-menu-th1"),document.getElementById("filter-menu-th2"),
							document.getElementById("filter-menu-th3"),document.getElementById("filter-menu-th4")];
				var tds = []; 
				var topics = [];
				var topicYear = [];
				for (var i = 1; i < lineNum; i++) {
					var arr = [];
					arr.push(dataArray[i][1]);
					arr.push(dataArray[i][2]);
					arr.push(dataArray[i][3]);
					arr.push(dataArray[i][12]);
		        	tds.push(arr);
		        	var s = dataArray[i][13].split(',').map(function (el) {
			            return el.trim();
			        });
			        for (var j = 0; j < s.length; j++) {
			        	if (topics.indexOf(s[j]) == -1) {
			        		topics.push(s[j]);
			        		topicYear.push(dataArray[i][3]);
			        	}
			        	else {
			        		continue;
			        	}
			        }
		        }
		        var heads = dataArray[0].slice(1,4);
		        heads.push(dataArray[0][12]);
				var filterCollection = new FilterCollection($('#filter-table'), options, ths, tds, heads, dataArray);
				filterCollection.initialize();
				//var venueNames = filterCollection.filterMenus[1].tds;
				makeTopics(topics, topicYear, dataArray, filterCollection);
				makeVenueList(dataArray);
				
				/**
				 * Search autocomplete
				 */
				var availableTags = [];
				for (var lineCount = 1; lineCount < lineNum; lineCount++) {
					for (var cellCount = 0; cellCount < cellNum; cellCount++) {
						if (cellCount == 0 || cellCount == 1 || cellCount == 2 || cellCount == 3 || cellCount == 4 ||
							cellCount == 6 || cellCount == 8 || cellCount == 9 || cellCount == 10 || cellCount == 12 || cellCount == 13)
						tags = dataArray[lineCount][cellCount].split(',').map(function (el) {
			                return el.trim();
			            });
						availableTags = availableTags.concat(tags);
					}
				}
				availableTags = availableTags.filter(unique);
				availableTags.sort();
				$('#submit').click(function(){
					var searchKey = $("#search-key").val();
					var text = $('#btn-search-key');
					if (text.val().length > 0) {
						buttonKey = text.val().slice(0,-1);
					}
					else {
						buttonKey = "";
					}
					keywordSearch(searchKey, buttonKey, dataArray, filterCollection);
				});
				$("#full").tooltip();
				$("#search-key").autocomplete({
			    	source: availableTags
			    });

			});

			function Counter(name, count) {
				this.name = name;
				this.count = count;
			}

			function YearSort(name, year) {
				this.name = name;
				this.year = year;
			}

			window.detect = function() {
  				var check = false;
  				(function(a,b){if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a)||/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0,4)))check = true;})(navigator.userAgent||navigator.vendor||window.opera); 
  				return check;
  			};

			function unique(value, index, self) {
				return self.indexOf(value) === index;
			}

			function makeVenueList(dataArray) {
				d3.csv("publications/VenueSummary.csv").then(function (summary){
					var lineNum = dataArray.length;

					/**
					 * Sort the importance of venues
					 */
					summary.sort( function(a,b) {
						if (a.Type === "Others") return 1;
						if (b.Type === "Others") return -1;
						if (a.Type < b.Type) return -1;
						if (a.Type > b.Type) return 1;
						if (a.Type === b.Type) {
							if (Number(a.Rank) < Number(b.Rank)) return -1;
							if (Number(a.Rank) > Number(b.Rank))return 1;
							if (Number(a.Rank) === Number(b.Rank)) return 0;
						}
						else return 0;
					});
					var confNames = [];
					var confNum = [];
					for (var i = 0; i < summary.length; i++) {
						if (summary[i].Type === "Conference") {
							if (confNames.indexOf(summary[i].Summary) === -1) {
								confNames.push(summary[i].Summary);
								confNum.push(0);
							}
						}
					}
					var jourNames = [];
					var jourNum = [];
					for (var i = 0; i < summary.length; i++) {
						if (summary[i].Type === "Journal") {
							if (jourNames.indexOf(summary[i].Summary) === -1) {
								jourNames.push(summary[i].Summary);
								jourNum.push(0);
							}
						}
					}
					
					/** 
			         * Get numbers of each venue
			         */		
					for (var lineCount = 1; lineCount < lineNum; lineCount++) {
						var v = dataArray[lineCount][2].split(',').map(function (el) {
				            return el.trim();
				        });
						if (dataArray[lineCount][4] === "Journal Papers") {
							for (var jourCount = 0; jourCount < summary.length; jourCount++) {
					        	for (var vCount = 0; vCount < v.length; vCount++) {
					        		if (summary[jourCount].Abbr === v[vCount]) {
					        			for (var i = 0; i < jourNames.length; i++) {
					        				if (jourNames[i] === summary[jourCount].Summary) {
					        					jourNum[i]++;
					        				}
					        			}		
					        		}
					        	}
					        }
						}
						if (dataArray[lineCount][4] === "Refereed Conference and Workshop Publications") {
							for (var confCount = 0; confCount < summary.length; confCount++) {
					        	for (var vCount = 0; vCount < v.length; vCount++) {
					        		if (summary[confCount].Abbr === v[vCount]) {
					        			for (var i = 0; i < confNames.length; i++) {
					        				if (confNames[i] === summary[confCount].Summary) {
					        					confNum[i]++;
					        				}
					        			}		
					        		}
					        	}
					        }
						}
					}
					/**
					 * Sort venue list
					 */
					var jourList = [];
					for (var jourCount = 0; jourCount < jourNames.length; jourCount++) {
			        	var cnt = new Counter(jourNames[jourCount], jourNum[jourCount]);
			        	jourList.push(cnt);
			        }
			        var confList = [];
					for (var confCount = 0; confCount < confNames.length; confCount++) {
			        	var cnt = new Counter(confNames[confCount], confNum[confCount]);
			        	confList.push(cnt);
			        }
			        /*
			        venueList.sort(function (a,b) {
			        	if (a.name == "Others") return 1;
			        	if (b.name == "Others") return -1;
			        	if (a.count < b.count) return 1;
			        	else if (a.count > b.count) return -1;
			        	else return 0;
			        });
			        */

			        /**
			         * Make venue menu in the dashboard
			         */
			        var titleLeft = document.getElementById('jour-title-left');
			        var titleRight = document.getElementById('jour-title-right');
			        var l = document.createElement('b');
					var r = document.createElement('b');
					var br1 = document.createElement('br');
					var br2 = document.createElement('br');
					l.innerText = "Journal";
					r.innerText = "#";
					titleLeft.appendChild(l);
					titleLeft.appendChild(br1);
					titleRight.appendChild(r);
					titleRight.appendChild(br2);
					for (var i = 0; i < jourList.length; i++) {
						var jourLeft = document.getElementById('jour-left');
			       		var jourRight = document.getElementById('jour-right');
						var vName = document.createElement('span');
						var vNum = document.createElement('span');
						var vBr1 = document.createElement('br');
						var vBr2 = document.createElement('br');
						var maxlen;
						if ($(window).width() < 1024) {
							maxlen = 100;
						}
						else {
							maxlen = 11;
						}
						if (jourList[i].name.length > maxlen) {
							vName.innerText = jourList[i].name.slice(0,maxlen-2)+"..";
						}
						else {
							vName.innerText = jourList[i].name;
						}
						vNum.innerText = " (" + jourList[i].count + ")";
						jourLeft.appendChild(vName);
						jourLeft.appendChild(vBr1);
						jourRight.appendChild(vNum);
						jourRight.appendChild(vBr2);	
					}

					var titleLeft = document.getElementById('conf-title-left');
			        var titleRight = document.getElementById('conf-title-right');
			        var l = document.createElement('b');
					var r = document.createElement('b');
					var br1 = document.createElement('br');
					var br2 = document.createElement('br');
					l.innerText = "Conference";
					r.innerText = "#";
					titleLeft.appendChild(l);
					titleLeft.appendChild(br1);
					titleRight.appendChild(r);
					titleRight.appendChild(br2);
					for (var i = 0; i < confList.length; i++) {
						var confLeft = document.getElementById('conf-left');
			       		var confRight = document.getElementById('conf-right');
						var vName = document.createElement('span');
						var vNum = document.createElement('span');
						var vBr1 = document.createElement('br');
						var vBr2 = document.createElement('br');
						var maxlen;
						if ($(window).width() < 1024) {
							maxlen = 100;
						}
						else {
							maxlen = 11;
						}
						if (confList[i].name.length > maxlen) {
							vName.innerText = confList[i].name.slice(0,maxlen-2)+"..";
						}
						else {
							vName.innerText = confList[i].name;
						}
						vNum.innerText = " (" + confList[i].count + ")";
						confLeft.appendChild(vName);
						confLeft.appendChild(vBr1);
						confRight.appendChild(vNum);
						confRight.appendChild(vBr2);	
					}
				});
			}

			function makeTopics(topics, topicYear, dataArray, filterCollection) {
				var lineNum = dataArray.length;
				/**
				 * Sort by time
				 */
				var topicYearList = [];
				for (var topicCount = 0; topicCount < topics.length; topicCount++) {
					var cnt = new YearSort(topics[topicCount], topicYear[topicCount]);
					topicYearList.push(cnt);
		        }
		        topicYearList.sort(function (a,b) {
		        	if (a.name == "Others") return 1;
		        	if (b.name == "Others") return -1;
		        	if (a.year < b.year) return 1;
		        	else if (a.year > b.year) return -1;
		        	else return 0;
		        });


		        /** 
		         * Get numbers of each topic
		         */
				var topicNum = [];
				for (var topicCount = 0; topicCount < topics.length; topicCount++) {
		        	topicNum.push(0);
		        }
				var pastTenYear = Number(dataArray[1][3])-100;			
				for (var lineCount = 1; lineCount < lineNum; lineCount++) {
					if (Number(dataArray[lineCount][3]) <= pastTenYear) {
						break;
					}
					var t = dataArray[lineCount][13].split(',').map(function (el) {
			            return el.trim();
			        });
			        for (var topicCount = 0; topicCount < topics.length; topicCount++) {
			        	for (var tCount = 0; tCount < t.length; tCount++) {
			        		if (topics[topicCount] === t[tCount]) {
			        			topicNum[topicCount]++;
			        		}
			        	}
			        }
				}
				/**
				 * Sort by number of publications
				 */	
				var topicList = [];
				for (var topicCount = 0; topicCount < topics.length; topicCount++) {
					var cnt = new Counter(topics[topicCount], topicNum[topicCount]);
					topicList.push(cnt);
		        }
		        topicList.sort(function (a,b) {
		        	if (a.name == "Others") return 1;
		        	if (b.name == "Others") return -1;
		        	if (a.count < b.count) return 1;
		        	else if (a.count > b.count) return -1;
		        	else return 0;
		        });
		        
		        /**
		         * Make topic table in the dashboard
		         */
		        var titleLeft = document.getElementById('topic-title-left');
		        var titleRight = document.getElementById('topic-title-right');
		        var l = document.createElement('b');
				var r = document.createElement('b');
				var br1 = document.createElement('br');
				var br2 = document.createElement('br');
				l.innerText = "Topic";
				r.innerText = "#";
				titleLeft.appendChild(l);
				titleLeft.appendChild(br1);
				titleRight.appendChild(r);
				titleRight.appendChild(br2);
				for (var i = 0; i < topicList.length; i++) {
					var topicLeft = document.getElementById('topic-left');
		       		var topicRight = document.getElementById('topic-right');
					var vName = document.createElement('span');	
					var vNum = document.createElement('span');
					var vBr1 = document.createElement('br');
					var vBr2 = document.createElement('br');

					var maxlen;
					if ($(window).width() < 1024) {
						maxlen = 100;
					}
					else if ($(window).width() >= 1024 && $(window).width() < 1150){
						maxlen = 16;
					}
					else if ($(window).width() >= 1150 && $(window).width() < 1260){
						maxlen = 17;
					}
					else if ($(window).width() >= 1260 && $(window).width() < 1370){
						maxlen = 18;
					}
					else {
						maxlen = 20;
					}
					if (topicList[i].name.length > maxlen) {
						vName.innerText = topicList[i].name.slice(0,maxlen-2)+"..";
					}
					else {
						vName.innerText = topicList[i].name;
					}
					
					vNum.innerText = " (" + topicList[i].count + ")";
					topicLeft.appendChild(vName);
					topicLeft.appendChild(vBr1);
					topicRight.appendChild(vNum);
					topicRight.appendChild(vBr2);	
				}
				
				/**
				 * Make topic buttons for search
				 */
				var hintsDiv = document.getElementById('topic-hints');
				var hintsTitle = document.createElement('h4');
				hintsTitle.innerText = "Research Topics: ";
				hintsDiv.appendChild(hintsTitle);
				var j = 0;
				var hintsTable = document.createElement('table');
				var hintsTR = document.createElement('tr');
				hintsTable.style = "border=1;width:100%;";
				for (var i = 0; i < topicList.length; i++) {
					var hintTD = document.createElement('td');
					hintTD.style = "padding-right:3px;padding-bottom:4px;width:33.33%;";
					var hintsButton = document.createElement('button');
					hintsButton.id = "hBtn-" + (i+1);
					hintsButton.classList.add("hintsButtonNormal");
					hintsButton.innerText = topicYearList[i].name;
					hintsButton.style = "border-radius:4px;height:35px;width:100%;font-size:14px;";
					hintTD.appendChild(hintsButton);
					hintsTR.appendChild(hintTD);
					if (j === 2 || i === (topicList.length-1)) {
						hintsTable.appendChild(hintsTR);
						if (i < (topicList.length-1)){
							hintsTR = document.createElement('tr');
						}
					}
					j = (j+1)%3;
				}
				hintsDiv.appendChild(hintsTable);
				//Add topic into input
				var buttonName = [];
				//for (var i = 1; i <= topicList.length; i++) {
				for (var i = 1; i <= topicYearList.length; i++) {
					buttonName.push("#hBtn-"+i);
				}
				var elements = buttonName.join(", ");

				var btnSearchKey = document.createElement('input');
				btnSearchKey.id = "btn-search-key";
				btnSearchKey.style.display = 'none';
				hintsDiv.appendChild(btnSearchKey);

				$(elements).click( function() {
					var b = $(this);
					var text = $('#btn-search-key');
					//console.log(text.val());
					if (b.hasClass('hintsButtonNormal')) {
						b.removeClass('hintsButtonNormal').addClass('hintsButtonReverse');
						text.val(text.val() + b.text()+',');
						var searchKey = $("#search-key").val();
						if (text.val().length > 0) {
							buttonKey = text.val().slice(0,-1);
						}
						else {
							buttonKey = "";
						}
						keywordSearch(searchKey, buttonKey, dataArray, filterCollection);
					}
					else {
						b.removeClass('hintsButtonReverse').addClass('hintsButtonNormal');
						var del = b.text()+',';
						var hasDel = text.val().indexOf(b.text());
						var replace;
						if (hasDel >= 0) {
							replace = text.val().replace(del, "").trim();
						}
						else {
							replace = "";
						}
						text.val(replace);
						var searchKey = $("#search-key").val();
						if (text.val().length > 0) {
							buttonKey = text.val().slice(0,-1);
						}
						else {
							buttonKey = "";
						}
						keywordSearch(searchKey, buttonKey, dataArray, filterCollection);
					}
				});

				/**
				 * Use Google API to draw the barchart for the research topics
				 */
		        google.charts.load('current', {'packages':['corechart']});
				google.charts.setOnLoadCallback(drawChart3);
				// Draw the chart and set the chart values
				function drawChart3() {
					var data = google.visualization.arrayToDataTable([
						["Topic", "Num"],
						[topicList[0].name, topicList[0].count],
						[topicList[1].name, topicList[1].count],
						[topicList[2].name, topicList[2].count],
						]);
					// Optional; add a title and set the width and height of the chart
					var options = {
						height: 180,
						vAxis: {
							textPosition: "out",
							textStyle: {fontSize: 8}
						},
						legend: { position: "none" },
						bar: { groupWidth: "50%"},
						hAxis: {
							viewWindow: { 
								min: 0, 
								max: topicList[0].count
							}
						},
						titleTextStyle: {fontSize: 14, bold: true}
					};
					// Display the chart inside the <div> element with id="piechart"
					var chart = new google.visualization.BarChart(document.getElementById('bar_chart'));
					chart.draw(data, options);
				}
			}

			/**
			 * Object designed for a single filtermenu
			 */
			var FilterMenu = function () {
			    function FilterMenu(target, th, index, options, tds, heads) {
			        this.options = options;
			        this.th = th;
			        this.index = index;
			        this.tds = [];
			        for (var i = 0; i < tds.length; i++) {
			        	if (tds[i][index] == "") continue;
			        	this.tds.push(tds[i][index]);
			        }
			        this.head = heads[index];
			    }

			    //Initialize the search dropdown
			    FilterMenu.prototype.initialize = function () {
			        this.menu = this.dropdownFilterDropdown();
			        this.th.appendChild(this.menu);
			        var $trigger = $(this.menu.children[0]);
			        var $content = $(this.menu.children[1]);
			        var $menu = $(this.menu);
			        //the action of looking at the menu content
			        $trigger.click(function () {
			            return $content.toggle();
			        });
			        //click the area out of the menu
			        $(document).click(function (el) {
			            if (!$menu.is(el.target) && $menu.has(el.target).length === 0) {
			                $content.hide();
			            }
			        });
			    };

			    //update the selectAllCheckbox
			    FilterMenu.prototype.updateSelectAll = function () {
			            if (this.selectAllCheckbox instanceof HTMLInputElement) {
			            this.selectAllCheckbox.checked = this.inputs.length === this.inputs.filter(function (input) {
			                return input.checked;
			            }).length;
			        }
			    };

			    //update all checkbox
			    FilterMenu.prototype.selectAllUpdate = function (checked) {
			        this.toggleAll(checked);
			    };

			    //get all checkboxes into the checked value
			    FilterMenu.prototype.toggleAll = function (checked) {
			        for (var i = 0; i < this.inputs.length; i++) {
			            var input = this.inputs[i];
			            if (input instanceof HTMLInputElement) input.checked = checked;
			        }
			    };

			    //create an item in the dropdown filter
			    FilterMenu.prototype.dropdownFilterItem = function (td, self) {
			        var value = td.innerText;
			        //create a section for filter item
			        var dropdownFilterItem = document.createElement('div');
			        dropdownFilterItem.className = 'dropdown-filter-item';
			        var input = document.createElement('input');
			        input.type = 'checkbox';
			        input.value = value.trim().replace(/ +(?= )/g, '');
			        input.setAttribute('checked', 'checked');
			        input.className = 'dropdown-filter-menu-item item';
			        input.setAttribute('data-index', self.index.toString());
			        dropdownFilterItem.appendChild(input);
			        dropdownFilterItem.innerHTML = dropdownFilterItem.innerHTML.trim() + ' ' + value;
			        return dropdownFilterItem;
			    };

			    //create the selectall item in the dropdown filter
			    FilterMenu.prototype.dropdownFilterItemSelectAll = function () {
			        var value = this.options.captions.select_all;
			        var dropdownFilterItemSelectAll = document.createElement('div');
			        dropdownFilterItemSelectAll.className = 'dropdown-filter-item';
			        var input = document.createElement('input');
			        input.type = 'checkbox';
			        input.value = value;
			        input.setAttribute('checked', 'checked');
			        input.className = 'dropdown-filter-menu-item select-all';
			        input.setAttribute('data-index', this.index.toString());
			        dropdownFilterItemSelectAll.appendChild(input);
			        dropdownFilterItemSelectAll.innerHTML = dropdownFilterItemSelectAll.innerHTML + ' ' + value;
			        return dropdownFilterItemSelectAll;
			    };
			    
			    FilterMenu.prototype.dropdownFilterContent = function () {
			        var _this = this;
			        var self = this;
			        var dropdownFilterContent = document.createElement('div');
			        dropdownFilterContent.className = 'dropdown-filter-content';
			        //create a section for each td
			        var innerDivs = this.tds.reduce(function (arr, el) {
			            var values = arr.map(function (el) {
			                return el.innerText.trim();
			            });
			            
			            /* split authors here */
			            var cells = el.split(',');
			            for (var i = 0; i < cells.length; i++) {
			                var tdCell = document.createElement("td");
			                var tdCellText = document.createTextNode(cells[i]);
			                tdCell.appendChild(tdCellText);
			                if (values.indexOf(cells[i].trim()) === -1) arr.push(tdCell);
			            }
			            return arr;

			        }, []).sort(function (a, b) { //filteritems are sorted from low to high
			            var A = a.innerText.toLowerCase();
			            var B = b.innerText.toLowerCase();
			            if (!isNaN(Number(A)) && !isNaN(Number(B))) {
			                if (Number(A) < Number(B)) return 1;
			                if (Number(A) > Number(B)) return -1;
			            } else {
			                if (A < B) return 1;
			                if (A > B) return -1;
			            }
			            return 0;
			        });
			        this.tds = innerDivs.map(function (td) {
			        	return td.innerText;
			        });
			        innerDivs = innerDivs.map(function (td) {
			            return _this.dropdownFilterItem(td, self); 
			        });
			        
			        //create inputs array
			        this.inputs = innerDivs.map(function (div) {
			            return div.firstElementChild;
			        });
			        var selectAllCheckboxDiv = this.dropdownFilterItemSelectAll();
			        this.selectAllCheckbox = selectAllCheckboxDiv.firstElementChild;
			        innerDivs.unshift(selectAllCheckboxDiv); //innerDivs contains selectAll

			        //create a section for all the divs in innerDivs(tds and selectAll)
			        var outerDiv = innerDivs.reduce(function (outerDiv, innerDiv) {
			            outerDiv.appendChild(innerDiv);
			            return outerDiv;
			        }, document.createElement('div'));
			        outerDiv.className = 'checkbox-container';

			        //return an array for all the things 
			        var elements = [];
			        return elements.concat(outerDiv).reduce(function (html, el) {
			            html.appendChild(el);
			            return html;
			        }, dropdownFilterContent);
			    };

			    FilterMenu.prototype.dropdownFilterContent2 = function () {
			        var _this = this;
			        var self = this;
			        var dropdownFilterContent = document.createElement('div');
			        dropdownFilterContent.className = 'dropdown-filter-content';
			        //create a section for each td
			        var innerDivs = this.tds.reduce(function (arr, el) {
			            var values = arr.map(function (el) {
			                return el.innerText.trim();
			            });
			            
			            /* split authors here */
			            var cells = el.split(',');

			            for (var i = 0; i < cells.length; i++) {
			                var tdCell = document.createElement("td");
			                var tdCellText = document.createTextNode(cells[i].trim());
			                tdCell.appendChild(tdCellText);
			                if (values.indexOf(cells[i].trim()) === -1) arr.push(tdCell);
			            }
			            return arr;

			        }, []).sort(function (a, b) { //filteritems are sorted from low to high
			            var Alist = a.innerText.toLowerCase().split(" ");
			            var Blist = b.innerText.toLowerCase().split(" ");
			            var A = Alist[Alist.length-1];
			            var B = Blist[Blist.length-1];
			            if (!isNaN(Number(A)) && !isNaN(Number(B))) {
			                if (Number(A) < Number(B)) return -1;
			                if (Number(A) > Number(B)) return 1;
			            } else {
			                if (A < B) return -1;
			                if (A > B) return 1;
			            }
			            return 0;
			        });
			        this.tds = innerDivs.map(function (td) {
			        	return td.innerText;
			        });
			        innerDivs = innerDivs.map(function (td) {
			            return _this.dropdownFilterItem(td, self); 
			        });
			        
			        //create inputs array
			        this.inputs = innerDivs.map(function (div) {
			            return div.firstElementChild;
			        });
			        var selectAllCheckboxDiv = this.dropdownFilterItemSelectAll();
			        this.selectAllCheckbox = selectAllCheckboxDiv.firstElementChild;
			        innerDivs.unshift(selectAllCheckboxDiv); //innerDivs contains selectAll

			        //create a section for all the divs in innerDivs(tds and selectAll)
			        var outerDiv = innerDivs.reduce(function (outerDiv, innerDiv) {
			            outerDiv.appendChild(innerDiv);
			            return outerDiv;
			        }, document.createElement('div'));
			        outerDiv.className = 'checkbox-container';

			        //return an array for all the things 
			        var elements = [];
			        return elements.concat(outerDiv).reduce(function (html, el) {
			            html.appendChild(el);
			            return html;
			        }, dropdownFilterContent);
			    };

			    FilterMenu.prototype.dropdownFilterContent3 = function () {
			        var _this = this;
			        var self = this;
			        var dropdownFilterContent = document.createElement('div');
			        dropdownFilterContent.className = 'dropdown-filter-content';
			        //create a section for each td
			        var innerDivs = this.tds.reduce(function (arr, el) {
			            var values = arr.map(function (el) {
			                return el.innerText.trim();
			            });
			            
			            /* split authors here */
			            var cells = el.split(',');

			            for (var i = 0; i < cells.length; i++) {
			                var tdCell = document.createElement("td");
			                var tdCellText = document.createTextNode(cells[i].trim());
			                tdCell.appendChild(tdCellText);
			                if (values.indexOf(cells[i].trim()) === -1) arr.push(tdCell);
			            }
			            return arr;

			        }, []).sort(function (a, b) { //filteritems are sorted from low to high
			            var Alist = a.innerText.toLowerCase().split(" ");
			            var Blist = b.innerText.toLowerCase().split(" ");
			            var A = Alist[0];
			            var B = Blist[0];
			            if (!isNaN(Number(A)) && !isNaN(Number(B))) {
			                if (Number(A) < Number(B)) return -1;
			                if (Number(A) > Number(B)) return 1;
			            } else {
			                if (A < B) return -1;
			                if (A > B) return 1;
			            }
			            return 0;
			        });
			        this.tds = innerDivs.map(function (td) {
			        	return td.innerText;
			        });
			        innerDivs = innerDivs.map(function (td) {
			            return _this.dropdownFilterItem(td, self); 
			        });
			        
			        //create inputs array
			        this.inputs = innerDivs.map(function (div) {
			            return div.firstElementChild;
			        });
			        var selectAllCheckboxDiv = this.dropdownFilterItemSelectAll();
			        this.selectAllCheckbox = selectAllCheckboxDiv.firstElementChild;
			        innerDivs.unshift(selectAllCheckboxDiv); //innerDivs contains selectAll

			        //create a section for all the divs in innerDivs(tds and selectAll)
			        var outerDiv = innerDivs.reduce(function (outerDiv, innerDiv) {
			            outerDiv.appendChild(innerDiv);
			            return outerDiv;
			        }, document.createElement('div'));
			        outerDiv.className = 'checkbox-container';

			        //return an array for all the things 
			        var elements = [];
			        return elements.concat(outerDiv).reduce(function (html, el) {
			            html.appendChild(el);
			            return html;
			        }, dropdownFilterContent);
			    };

			    FilterMenu.prototype.dropdownFilterDropdown = function () {
			        //create a block here
			        var index = this.index;
			        var dropdownFilterDropdown = document.createElement('div');
			        dropdownFilterDropdown.className = 'dropdown-filter-dropdown';
			        var arrow = document.createElement('span');
			        var text = document.createElement('i');
			        text.style = "width:180px;text-align:left;display:inline-block;padding-left:5px";
			        text.innerText = "All";
			        text.id = "chosen-text-" + this.index;
			        arrow.className = 'dropdown-filter-icon';
			        var icon = document.createElement('i');
			        icon.className = 'arrow-down';
			        arrow.appendChild(text);
			        arrow.appendChild(icon);
			        dropdownFilterDropdown.appendChild(arrow);
			        if (index === 0) {
			        	dropdownFilterDropdown.appendChild(this.dropdownFilterContent2());   
			        }
			        else if (index === 2) {
			        	dropdownFilterDropdown.appendChild(this.dropdownFilterContent());   
			        } 
			        else {
			        	dropdownFilterDropdown.appendChild(this.dropdownFilterContent3());   
			        } 
			        return dropdownFilterDropdown;
			    };

			    FilterMenu.prototype.updateChosenText = function () {
			    	var text = document.getElementById("chosen-text-"+this.index);
			    	var chosenNum = this.inputs.filter(function (input) {
			    			return input.checked;
			    		}).length;
			    	if (chosenNum === 0) {
			    		text.innerText = "None";
			    	}
			    	else if (chosenNum === this.inputs.length) {
			    		text.innerText = "All";
			    	}
			    	else{
			    		for(var i = 0; i < this.inputs.length; i++) {
			    			if (this.inputs[i].checked) {
			    				if (chosenNum === 1) {
			    					if (this.tds[i] <= 16) {
			    						text.innerText = this.tds[i];
			    					}
			    					else {
			    						text.innerText = this.tds[i].slice(0,15) + "..";
			    					}
			    				}
			    				else{
			    					if (this.tds[i] <= 16) {
			    						text.innerText = this.tds[i] + " +" + (chosenNum-1);
			    					}
			    					else {
			    						text.innerText = this.tds[i].slice(0,15) + ".. +" + (chosenNum-1);
			    					}
			    				}
			    				break;
			    			}
			    		}
			    	}
			    	//window.alert(chosenNum);
			    }
			    return FilterMenu;
			}();

			/**
			 * Object designed for all filters and their functions
			 */
			var FilterCollection = function () {
			    function FilterCollection(target, options, ths, tds, heads, dataArray) {
			        this.target = target;
			        this.options = options;
			     	this.ths = ths;
			     	this.tds = tds;
			     	this.heads = heads;  
			     	this.dataArray = dataArray;
			        //create a property for filterMenus of each th
			        this.filterMenus = this.ths.map(function (th, index) {
			            return new FilterMenu(target, th, index, options, tds, heads);
			        });		        
			    }
			    //initialize the filter collection
			    FilterCollection.prototype.initialize = function () {
			        this.filterMenus.forEach(function (filterMenu) {
			            filterMenu.initialize();
			        });
			        this.bindCheckboxes();
			        this.bindSelectAllCheckboxes();
			    };
			    FilterCollection.prototype.bindCheckboxes = function () {
			        var filterMenus = this.filterMenus;
			        var dataArray = this.dataArray;
			        var _this = this;
			        this.target.find('.dropdown-filter-menu-item.item').change(function () {
			            var index = $(this).data('index');
			            var value = $(this).val();
			            filterMenus[index].updateSelectAll();
			            filterMenus[index].updateChosenText();
			            var searchKey = $("#search-key").val();
						var text = $('#btn-search-key');
						if (text.val().length > 0) {
							buttonKey = text.val().slice(0,-1);
						}
						else {
							buttonKey = "";
						}
			            keywordSearch(searchKey, buttonKey, dataArray, _this);
			        });
			        
			    };
			    FilterCollection.prototype.bindSelectAllCheckboxes = function () {
			        var filterMenus = this.filterMenus;
			        var dataArray = this.dataArray;
			        var _this = this;
			        this.target.find('.dropdown-filter-menu-item.select-all').change(function () {
			            var index = $(this).data('index');
			            var value = this.checked;
			            filterMenus[index].selectAllUpdate(value);
			            filterMenus[index].updateChosenText();
			            var searchKey = $("#search-key").val();
						var text = $('#btn-search-key');
						if (text.val().length > 0) {
							buttonKey = text.val().slice(0,-1);
						}
						else {
							buttonKey = "";
						}
			            keywordSearch(searchKey, buttonKey, dataArray, _this);
			        });

			    };


			    FilterCollection.prototype.updateRowVisibility = function (dataArray) {
			    	var filterMenus = this.filterMenus;
			    	var ths = this.ths;
			    	var lineNum = dataArray.length-1;
			        var selectedLists = filterMenus.map(function (filterMenu) {
			            return {
			                index: filterMenu.index,
			                //the text which are checked
			                selected: filterMenu.inputs.filter(function (input) {
			                    return input.checked;
			                }).map(function (input) {
			                    return input.value.trim().replace(/ +(?= )/g, '');
			                })
			            };
			        });
			        //filter each row
					for (var lineCount = 0; lineCount < lineNum; lineCount++) {
						var cells = dataArray[lineCount+1].slice(1,4);
						cells.push(dataArray[lineCount+1][12]); 
						if (document.getElementById(lineCount).style.display === 'none') {
							continue;
						}
						for (var j = 0; j < selectedLists.length; j++) {  
							          
			                var content = cells[selectedLists[j].index].split(',').map(function (el) {
			                	return el.trim();
			            	});
			                //Single choice
			                if (content.length === 1) {
			                    if (selectedLists[j].selected.indexOf(content[0]) === -1) {
			                        document.getElementById(lineCount).style.display = 'none';
			                        break;
			                    }
			                }
			                //Multiple choices
			                else{
			                    var hid = 1; // current row hide or not
			                    //traverse every element in the array, judge if it exists in the selected lists
			                    for (var k = 0; k < content.length; k++) {
			                        if (selectedLists[j].selected.indexOf(content[k]) != -1) {
			                            //window.alert(content[k] + ' is in ' + selectedLists[j].selected);
			                            hid = 0;
			                            document.getElementById(lineCount).style.display = 'block';
			                            break;
			                        }
			                        //window.alert(content[k] + ' is not in ' + selectedLists[j].selected);
			                    }
			                    if (hid === 1) {
			                    	document.getElementById(lineCount).style.display = 'none';
			                    	break;
			                    } 
			                }
			            }
					}
			    };
			    return FilterCollection;
			}();

			/**
			 * Extract Data from the csv and sort them by pre-defined order
			 */
			function processData(data){
				var headCells = [];
				for (var key in data[0]) {
					headCells.push(key);
				}
				var yearCol = headCells.indexOf('Years');
				var typeCol = headCells.indexOf('Types');
				var monthCol = headCells.indexOf('Months');
				var lineNum = data.length;
				var bodyLines = [];
				for (var lineCount = 0; lineCount<lineNum; lineCount++){
					var line = [];

					for (var i = 0; i < headCells.length; i++){
						line.push(data[lineCount][headCells[i]]);
					}

					bodyLines.push(line);
					//bodyLines[lineCount-1] = lines[lineCount].split(',');
				}
				bodyLines.sort(function(x, y){
					var yearX = Number(x[yearCol]);
					var yearY = Number(y[yearCol]);
					var typeX = x[typeCol].toString().toLowerCase();
					var typeY = y[typeCol].toString().toLowerCase();
					if (typeX === "journal papers") typeX = 0;
					if (typeX === "books or book chapters") typeX = 1;
					if (typeX === "refereed conference and workshop publications") typeX = 2;
					if (typeX === "theses") typeX = 3;
					if (typeX === "patents") typeX = 4;
					if (typeY === "journal papers") typeY = 0;
					if (typeY === "books or book chapters") typeY = 1;
					if (typeY === "refereed conference and workshop publications") typeY = 2;
					if (typeY === "theses") typeY = 3;
					if (typeY === "patents") typeY = 4;
					var titleX = x[0].toLowerCase();
					var titleY = y[0].toLowerCase();
					var monthX = Number(x[monthCol]);
					var monthY = Number(y[monthCol]);
					if (!isNaN(yearX) && !isNaN(yearY)) {
		                if (yearX < yearY) return 1;
		                if (yearX > yearY) return -1;
		                if (yearX === yearY) {
		                	if (typeX < typeY) return -1;
		                	if (typeX > typeY) return 1;
		                	if (typeX === typeY) {
		                		if (!isNaN(monthX) && !isNaN(monthY)){
		                			if(monthX < monthY) return 1;
		                			if(monthX > monthY) return -1;
		                			if(monthX === monthY) {
		                				if (titleX < titleY) return -1;
		                				if (titleX > titleY) return 1;
		                			}
		                		} 
		                	}
		                }
		            }
					return 0;
				});
				return [headCells].concat(bodyLines);
			}
			
			/**
			 * Generate all the content on the webpage before any filter operations
			 */
			function generateContent(headCells, bodyLines){
				d3.csv("publications/Venue.csv").then(function(data){
					var lineNum = bodyLines.length;
					var yearCol = headCells.indexOf('Years');
					var typeCol = headCells.indexOf('Types');

					var tmpYear = 0;
					var tmpType = "";
					var yearId = 0;
					var typeId = 0;
					var fullList = document.getElementById('full-list');

					var yearCount = 0;
					var typeCount = [0, 0, 0, 0, 0];

					var yearList = [];
					var typeList = [['Type', 'Number']];

					for(var lineCount = 0; lineCount<lineNum; lineCount++){
						var cells = bodyLines[lineCount];
						var year = Number(cells[yearCol]);
						var type = cells[typeCol];
						if (type.toString().toLowerCase() === "journal papers") typeCount[0]++;
						if (type.toString().toLowerCase()  === "books or book chapters") typeCount[1]++;
						if (type.toString().toLowerCase()  === "refereed conference and workshop publications") typeCount[2]++;
						if (type.toString().toLowerCase() === "theses") typeCount[3]++;
						if (type.toString().toLowerCase()  === "patents") typeCount[4]++;
						//Create a new year section
						if (tmpYear != year){
							if (yearId != 0) {
								var yearLeft = document.getElementById('year-left');
					       		var yearRight = document.getElementById('year-right');
								var yName = document.createElement('span');
								var yNum = document.createElement('span');
								var yBr1 = document.createElement('br');
								var yBr2 = document.createElement('br');
								yName.innerText = tmpYear;
								yNum.innerText = " (" + yearCount + ")";
								yearLeft.appendChild(yName);
								yearLeft.appendChild(yBr1);
								yearRight.appendChild(yNum);
								yearRight.appendChild(yBr2);	
								
								var tmpYearList = [];
								tmpYearList.push(tmpYear.toString());
								tmpYearList.push(yearCount);
								yearList.push(tmpYearList);
							}
							yearId++;
							tmpYear = year;
							tmpType = "";
							var yearDiv = document.createElement('div');
							var h2 = document.createElement('h2');
							h2.innerText = tmpYear;
							var num = document.createElement("i");
							num.style = "color:lightgrey";
							num.id = "year-count" + yearId;
							num.style.display = 'none';
							yearDiv.appendChild(h2);
							yearDiv.appendChild(num);
							yearDiv.id = "year" + yearId;
							fullList.appendChild(yearDiv);
							yearCount = 0;
						}
						yearCount++;

						if (tmpType != type){
							typeId++;
							tmpType = type;
							var typeDiv = document.createElement('div');
							var h4 = document.createElement('h4');
							var hr = document.createElement('hr');
							h4.innerText = tmpType;
							typeDiv.appendChild(h4);
							typeDiv.appendChild(hr);
							typeDiv.id = "type" + typeId;
							fullList.appendChild(typeDiv);
						}
						
						var table = document.createElement('table');
						var tbody = document.createElement('tbody');
						var tr = document.createElement('tr');
						var td1 = document.createElement('td');
						var td2 = document.createElement('td');
						var ul = document.createElement('ul');
						var li = document.createElement('li');
						var span = document.createElement('span');

						//Topic and author text
						if (cells[0] != "") {
							var authorText = document.createTextNode(cells[1]+ ', \"');
							var topicText = document.createElement("b")
							var quoteText = document.createTextNode("\", ");
							topicText.innerText = cells[0].toString();
							span.appendChild(authorText);
							span.appendChild(topicText);
							span.appendChild(quoteText);
						}
						else {
							var authorText =  document.createTextNode(cells[1] + " (Eds), ");
							span.appendChild(authorText);
						}

						//Venue Text
						var venueText = document.createElement('i');
						venueText.innerText = "";
						var lab = 0;
						for (var i = 0; i < data.length; i++) {
							var venueList = cells[2].split(",").map(function(el){
								return el.trim();
							});
							for (var j = 0; j < venueList.length; j++) {
								if (data[i].Abbr === venueList[j]) {
									venueText.innerText += data[i].Name.toString() + ", ";
									lab = 1;
								}
							}
						}

						if (lab === 0) {
							if (cells[2].indexOf("Books") != -1 || cells[2].indexOf("Others") != -1) {
								venueText.innerText += cells[10].toString() + ", ";
							}
						}
						span.appendChild(venueText);	

						//Track Text
						if (cells[6] != "") {
							var trackText = document.createElement('i');
							trackText.innerText = cells[6] + ", ";
							span.appendChild(trackText);
						}
						
						if (cells[7] != "") {
							var pageText = document.createTextNode(cells[7] + ", ");
							span.appendChild(pageText);
						}

						if (cells[8] != "") {
							var addText = document.createTextNode(cells[8] + ", ");
							span.appendChild(addText);
						}

						var timeText = document.createTextNode(monthTranslate(Number(cells[5])) + " " + cells[3]);
						span.appendChild(timeText);
			
						if (cells[9] != "") {
							var comma = document.createTextNode(", ");
							var awardText = document.createElement("b");
							awardText.innerText = cells[9];
							span.appendChild(comma);
							span.appendChild(awardText);
						}
						var periodText = document.createTextNode(".");
						span.appendChild(periodText);

						//var topicText = document.createTextNode(" [" + cells[12] + "]");
						//span.appendChild(topicText);
						
						var a = document.createElement('a');
						var img = document.createElement('img');
						var hr = document.createElement('hr');

						li.appendChild(span);
						ul.appendChild(li);
						td1.appendChild(ul);
						td1.align = "LEFT";
						td1.width = "100%";
						td1.style="padding-right: 40px"

						img.src = "img/pdf-icon.jpg";
						a.appendChild(img);
						if (cells[11] != "") {
							a.target="_blank";
						}
						if (cells[11].slice(0,4) === "http") {
							a.href = cells[11];
						}
						else {
							a.href = "publications/pdf/" + cells[11] + ".pdf";
						}

						var a2 = document.createElement('a');
						var img2 = document.createElement('img');
						if ((cells[14].length >= 13 && cells[14].slice(0,13) === "https://youtu") || (cells[14].length >= 17 && cells[14].slice(0,17) === "https://www.youtu")) {
							img2.src = "img/video-icon.png";
						}
						else {
							img2.src = "img/ppt-icon.png";
						}
						
						a2.appendChild(img2);
						if (cells[14] != "") {
							a2.target="_blank";
						}
						if (cells[14].slice(0,4) === "http") {
							a2.href = cells[14];
						}
						else {
							a2.href = "publications/presentation/" + cells[14] + ".pdf";
						}

						td2.appendChild(a);
						td2.width = "30";

						var td3 = document.createElement('td');
						td3.appendChild(a2);
						td3.width = "30";

						tr.appendChild(td1);
						tr.appendChild(td2);
						tr.appendChild(td3);
						tbody.appendChild(tr);
						table.appendChild(tbody);
						table.appendChild(hr);
						table.id = lineCount;
						fullList.appendChild(table);
					} 
					
					/**
		         	 * Make year menu in the dashboard
			         */
			        var yearTitleLeft = document.getElementById('year-title-left');
			        var yearTitleRight = document.getElementById('year-title-right');
			        var l = document.createElement('b');
					var r = document.createElement('b');
					var br1 = document.createElement('br');
					var br2 = document.createElement('br');
					l.innerText = "Year";
					r.innerText = "#";
					yearTitleLeft.appendChild(l);
					yearTitleLeft.appendChild(br1);
					yearTitleRight.appendChild(r);
					yearTitleRight.appendChild(br2);
					var yearLeft = document.getElementById('year-left');
		       		var yearRight = document.getElementById('year-right');
					var yName = document.createElement('span');
					var yNum = document.createElement('span');
					var yBr1 = document.createElement('br');
					var yBr2 = document.createElement('br');
					yName.innerText = tmpYear;
					yNum.innerText = " (" + yearCount + ")";
					yearLeft.appendChild(yName);
					yearLeft.appendChild(yBr1);
					yearRight.appendChild(yNum);
					yearRight.appendChild(yBr2);	

					var tmpYearList = [];
					tmpYearList.push(tmpYear.toString());
					tmpYearList.push(yearCount);
					yearList.push(tmpYearList);
					yearCount = 0;

					/**
		         	 * Make type menu in the dashboard
			         */
			        var typeTitleLeft = document.getElementById('type-title-left');
			        var typeTitleRight = document.getElementById('type-title-right');
			        var l = document.createElement('b');
					var r = document.createElement('b');
					var br1 = document.createElement('br');
					var br2 = document.createElement('br');
					l.innerText = "Type";
					r.innerText = "#";
					typeTitleLeft.appendChild(l);
					typeTitleLeft.appendChild(br1);
					typeTitleRight.appendChild(r);
					typeTitleRight.appendChild(br2);

					var typeString = ["Journal", "Book", "Conference", "Thesis", "Patent"];
					//var simType = ["Jour.", "Book", "Conf.", "Thes.", "Pat."];
					var simType = ["Journal", "Book", "Conference", "Thesis", "Patent"];
					for (var i = 0; i < typeCount.length; i++) {
						var typeLeft = document.getElementById('type-left');
			       		var typeRight = document.getElementById('type-right');
						var tName = document.createElement('span');
						var tNum = document.createElement('span');
						var tBr1 = document.createElement('br');
						var tBr2 = document.createElement('br');
						tName.innerText = typeString[i];
						tNum.innerText = " (" + typeCount[i] + ")";
						typeLeft.appendChild(tName);
						typeLeft.appendChild(tBr1);
						typeRight.appendChild(tNum);
						typeRight.appendChild(tBr2);	

						var tmpTypeList = [];
						tmpTypeList.push(simType[i].toString());
						tmpTypeList.push(typeCount[i]);
						typeList.push(tmpTypeList);
						//typeCount = 0;	
					}

					google.charts.load('current', {'packages':['corechart']});
					google.charts.setOnLoadCallback(drawChart1);
					yearList = yearList.sort(function(a,b){
						if (Number(a[0]) < Number(b[0])) return -1;
						else return 1;
					});
					yearList = [['Year', 'Number of Papers']].concat(yearList);
					function drawChart1() {
						var data = google.visualization.arrayToDataTable(yearList);
						var options = {
							titlePosition: 'none',
							curveType: 'function',
							legend: { position: 'bottom'},
							hAxis: {showTextEvery: '4'}
						};
						var chart = new google.visualization.LineChart(document.getElementById('curve_chart'));
						chart.draw(data, options);
					}

					google.charts.load('current', {'packages':['corechart']});
					google.charts.setOnLoadCallback(drawChart2);
					// Draw the chart and set the chart values
					function drawChart2() {
						var data = google.visualization.arrayToDataTable(typeList);
						// Optional; add a title and set the width and height of the chart
						var options = {
							titlePosition: 'none',
							legend: { position: 'bottom', maxLines:'3'}, 
							sliceVisibilityThreshold: 0,
							titleTextStyle: {fontSize: 15, bold: true}
						};
						// Display the chart inside the <div> element with id="piechart"
						var chart = new google.visualization.PieChart(document.getElementById('pie_chart'));
						chart.draw(data, options);
					}
				});
				
			}

			function monthTranslate(month) {
				if (month === 1) return "January";
				if (month === 2) return "February";
				if (month === 3) return "March";
				if (month === 4) return "April";
				if (month === 5) return "May";
				if (month === 6) return "June";
				if (month === 7) return "July";
				if (month === 8) return "August";
				if (month === 9) return "September";
				if (month === 10) return "October";
				if (month === 11) return "November";
				if (month === 12) return "December";
				return "";
			}

			function keywordSearch(searchKey, buttonKey, dataArray, filterCollection) {
				var keywords = searchKey.replace(/\W/g, ' ').split(' ');
				var topicWords = buttonKey.split(",");

				var matchArray = [];
				var lineNum = dataArray.length-1;

				for (var lineCount = 0; lineCount < lineNum; lineCount++) {
					var cells = dataArray[lineCount+1].slice(0);
				    var match = 0;
				    for (var wordCount = 0; wordCount < keywords.length; wordCount++) {
				    	var hid = 1;
						for (var cellCount = 0; cellCount < cells.length; cellCount++) {
							
							if (cells[cellCount].toLowerCase().indexOf(keywords[wordCount].toLowerCase()) != -1) {
								match += keywords[wordCount].length / cells[cellCount].replace(" ", "").length / (cells.length);
								hid = 0;
							}
						}
						if (hid === 1){
							document.getElementById(lineCount).style.display = 'none';
							break;
						}
					}
					if (hid === 0) {
						var hid2 = 1;
						for (var topicCount = 0; topicCount < topicWords.length; topicCount++) {
							if (cells[13].toLowerCase().indexOf(topicWords[topicCount].toLowerCase()) != -1) {
								document.getElementById(lineCount).style.display = 'block';
								hid2 = 0;
								break;
							}
						}
						if (hid2 === 1) {
							document.getElementById(lineCount).style.display = 'none';
						}
						matchArray.push(Number(match*100).toFixed(2) + "%");
					}
				}
				
				updateSection(dataArray, filterCollection);
			}

			function updateSection(dataArray, filterCollection){
				filterCollection.updateRowVisibility(dataArray);

				var lineNum = dataArray.length-1;
				var headCells = dataArray[0];
				var yearCol = headCells.indexOf('Years');
				var typeCol = headCells.indexOf('Types');

				var tmpYear = 0;
				var tmpType = "";
				var yearId = 0;
				var typeId = 0;
				var existYearId = [];
				var existTypeId = [];
				var resultNum = 0;
				var yearCount = [];
				for (var lineCount = 0; lineCount < lineNum; lineCount++) {
					var cells = dataArray[lineCount+1].slice(0);
					var year = Number(cells[yearCol]);
					var type = cells[typeCol];

					//Create a new year section
					if (tmpYear != year){
						yearId++;
						yearCount.push(0);
						tmpYear = year;
						tmpType = "";
					}

					if (tmpType != type){
						typeId++;
						tmpType = type;
					}
					if (document.getElementById(lineCount).style.display === 'block') {
						yearCount[yearId-1]++;
						if (existYearId.indexOf(yearId) === -1) {
							existYearId.push(yearId);	
						}
						if (existTypeId.indexOf(typeId) === -1) {
							existTypeId.push(typeId);
						}
						resultNum++;
					}				    
				}
				//window.alert(existYearId + " of " + yearId);
				//window.alert(existTypeId + " of " + typeId);

				//hide the year and type section
				for (var id = 1; id <= yearId; id++) {
					if(existYearId.indexOf(id) === -1) {
						document.getElementById("year"+id).style.display = 'none';	
					}else{
						document.getElementById("year"+id).style.display = 'block';
						document.getElementById("year-count"+id).style.display = 'block';
						document.getElementById("year-count"+id).innerText = yearCount[id-1] + " result(s)";
					}
				}
				for (var id = 1; id <= typeId; id++) {
					if(existTypeId.indexOf(id) === -1) {
						document.getElementById("type"+id).style.display = 'none';	
					}else{
						document.getElementById("type"+id).style.display = 'block';
					}
				}

				//show the search result
				var res = document.getElementById("search-result");
				res.innerText = resultNum + " result(s) found";
				res.style = "color:lightgrey";
			}
			
		</script>

	</body>
</html>